<script>

const anchorSeparator = '<%= anchorSeparator %>';

const icons = {
    more: 'assets/images/expand_more_black_24dp.svg',
    less: 'assets/images/expand_less_black_24dp.svg',
    menu: 'assets/images/menu_book_black_24dp.svg',
    close: 'assets/images/close_black_24dp.svg',
}

switchDoc(location.hash);

window.onhashchange = () => {
    switchDoc(location.hash);
}

function switchDoc(path) {

    if (!path) {
        window.location.hash = document.getElementsByClassName('markdown')[0].id;
        return;
    }

    path = path.replace(/\#/g, '');

    let anchors = path.split(anchorSeparator);
    let folderAnchor = anchors[0];
    let fileAnchor = anchors[1];
    let docAnchor = folderAnchor.concat(anchorSeparator, fileAnchor);
    let headerAnchor = anchors.length == 3 ? anchors[2] : null;

    let docs = document.getElementsByClassName('markdown');

    for (let doc of docs) {

        if (doc.id != docAnchor) {
            closeElement(doc);
            closeElement(document.getElementById('navItemContainer_' + doc.id));
        } else {
            openElement(doc);
            openElement(document.getElementById('navItemContainer_' + doc.id));
            if (headerAnchor) {
                document.getElementsByName(path)[0].scrollIntoView();
            } else {
                doc.parentElement.scrollTop = 0;
            }
        }

    }

    if (folderAnchor != 'root') {
        openSubMenu(folderAnchor);
    }
}

function toggleMenu() {

    const menu = document.querySelector('.nav-menu');
    toggleElement(menu);

    const menuIcon = document.querySelector('.nav-headerIcon');
    menuIcon.src = menuIcon.getAttribute('src') == icons.menu ? icons.close : icons.menu;

}

function toggleSubMenu(folderHeader) {

    const submenu = document.getElementById('subMenu_' + folderHeader);
    toggleElement(submenu);

    const submenuIcon = document.getElementById('subMenuIcon_' + folderHeader);
    submenuIcon.src = submenuIcon.getAttribute('src') == icons.more ? icons.less : icons.more;

}

function openSubMenu(folderHeader) {

    const submenu = document.getElementById('subMenu_' + folderHeader);

    if (!submenu.classList.contains('open'))
        toggleSubMenu(folderHeader);

}

function toggleElement(element) {
    element.classList.toggle('open');
}

function openElement(element) {
    element.classList.add('open');
}

function closeElement(element) {
    element.classList.remove('open');
}

</script>