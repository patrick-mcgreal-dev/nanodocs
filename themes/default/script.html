<script>

let currentFontSize = 100;

const anchorSeparator = '<%= anchorSeparator %>';

const icons = {
    more: 'assets/images/expand_more_black_24dp.svg',
    less: 'assets/images/expand_less_black_24dp.svg',
    menu: 'assets/images/menu_book_black_24dp.svg',
    close: 'assets/images/close_black_24dp.svg',
}

const themes = ['light', 'mid', 'dark'];

themeInit();
switchDoc(location.hash);

window.onhashchange = () => {
    switchDoc(location.hash);
}

function switchDoc(path) {

    if (!path) {
        window.location.hash = document.getElementsByClassName('markdown')[0].id;
        return;
    }

    path = path.replace(/\#/g, '');

    let anchors = path.split(anchorSeparator);
    let folderAnchor = anchors[0];
    let fileAnchor = anchors[1];
    let docAnchor = folderAnchor.concat(anchorSeparator, fileAnchor);
    let headerAnchor = anchors.length == 3 ? anchors[2] : null;

    let docs = document.getElementsByClassName('markdown');

    for (let doc of docs) {

        if (doc.id != docAnchor) {
            closeElement(doc);
            closeElement(document.getElementById('navItemContainer_' + doc.id));
        } else {
            openElement(doc);
            openElement(document.getElementById('navItemContainer_' + doc.id));
            if (headerAnchor) {
                document.getElementsByName(path)[0].scrollIntoView();
            } else {
                doc.parentElement.scrollTop = 0;
            }
        }

    }

    if (folderAnchor != 'root') {
        openSubMenu(folderAnchor);
    }
}

function toggleMenu() {

    toggleElement(document.querySelector('.nav-menu'));
    toggleElement(document.getElementById('navExpandIcon'));
    toggleElement(document.getElementById('navCollapseIcon'));

}

function toggleSubMenu(folderHeader) {

    toggleElement(document.getElementById('subMenu_' + folderHeader));
    toggleElement(document.getElementById('subMenuExpandIcon_' + folderHeader));
    toggleElement(document.getElementById('subMenuCollapseIcon_' + folderHeader));

}

function openSubMenu(folderHeader) {

    const submenu = document.getElementById('subMenu_' + folderHeader);

    if (!submenu.classList.contains('open'))
        toggleSubMenu(folderHeader);

}

function toggleElement(element) {
    element.classList.toggle('open');
}

function openElement(element) {
    element.classList.add('open');
}

function closeElement(element) {
    element.classList.remove('open');
}

function themeInit() {

    // theme menu

    document.onclick = (e) => {
        closeElement(document.getElementById('theme-menu'));
    };

    document.getElementById('theme-menuButton').onclick = (e) => {
        e.cancelBubble = true;
        toggleElement(document.getElementById('theme-menu'));
    };

    document.getElementById('theme-menu').onclick = (e) => {
        e.cancelBubble = true;
    };

    // font sizing

    let rules = document.styleSheets[0].cssRules;

    for (let rule of rules) {
        if (rule.selectorText != '.fontSize-regular') {
            continue;
        }
        currentFontSize = parseInt(rule.style.fontSize.replace('%', ''));
        break;
    }
}

function themeFontResize(inc) {
    if (inc > 0 && currentFontSize >= 150) return;
    if (inc < 0 && currentFontSize <= 50) return;
    currentFontSize += inc;
    document.documentElement.style.fontSize = currentFontSize.toString() + '%';
}

function themeChange(name) {

    let container = document.getElementById('container');

    for (let theme of themes) {
        container.classList.remove('themeVariant-' + theme);
    }

    container.classList.add('themeVariant-' + name);

}

</script>